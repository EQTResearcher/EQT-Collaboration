name: EQT Kanban Advanced Automation

on:
  issues:
    types: [opened, labeled, unlabeled, closed, reopened]
  pull_request:
    types: [opened, closed, reopened, ready_for_review]
  project_v2_item:  # 更新为 Projects V2 事件，替换 project_card
    types: [created, edited, deleted]

jobs:
  sync-status:
    runs-on: ubuntu-latest
    steps:
      - name: Sync labels to status
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}  # 需要 repo 和 projects:write 权限
          script: |
            const { issue } = context.payload;
            if (!issue) return;  // 只处理 issue 事件

            // GraphQL 查询：获取项目、字段和项
            const query = `
              query GetProjectAndItem($owner: String!, $repo: String!, $issueNumber: Int!) {
                repository(owner: $owner, name: $repo) {
                  projectV2(number: 1) {  # 替换为您的项目编号
                    id
                    fields(first: 20) {
                      nodes {
                        ... on ProjectV2SingleSelectField {
                          id
                          name
                          options {
                            id
                            name
                          }
                        }
                      }
                    }
                    items(first: 20) {
                      nodes {
                        id
                        fieldValues(first: 10) {
                          nodes {
                            ... on ProjectV2ItemFieldSingleSelectValue {
                              optionId
                            }
                          }
                        }
                        content {
                          ...
